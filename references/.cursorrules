# ============================================
# –ü–†–ê–í–ò–õ–ê –î–õ–Ø AI-–†–ï–î–ê–ö–¢–û–†–ê (Trae/Cursor/Copilot)
# –ü—Ä–æ–µ–∫—Ç: ALBOT - –¢–µ–ª–µ–≥—Ä–∞–º –±–æ—Ç –∫–ª—É–±–∞ –¥—ã—Ö–∞–Ω–∏—è
# ============================================

## üéØ –û–°–ù–û–í–ù–û–ô –°–¢–ï–ö
- Python 3.12+
- aiogram 3.x (–ù–ï aiogram 2!)
- SQLAlchemy 2.0 + asyncpg
- PostgreSQL
- Redis (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è FSM storage)
- loguru –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- Railway –¥–ª—è –¥–µ–ø–ª–æ—è

## üìÅ –°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê
```
bot/
‚îú‚îÄ‚îÄ handlers/          # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∏ callback
‚îú‚îÄ‚îÄ keyboards/inline/  # Inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îú‚îÄ‚îÄ middlewares/       # Middleware (DB, Auth)
‚îú‚îÄ‚îÄ services/          # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îú‚îÄ‚îÄ database/models/   # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îú‚îÄ‚îÄ core/config.py     # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (Pydantic)
‚îî‚îÄ‚îÄ __main__.py        # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
```

## üìö –û–ë–†–ê–ó–¶–´ –î–õ–Ø –ö–û–ü–ò–†–û–í–ê–ù–ò–Ø (–ø–∞–ø–∫–∞ references/)

### references/aiogram-sqlalchemy/
- –ü—Ä–æ—Å—Ç–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ handlers
- Database middleware
- SQLAlchemy –º–æ–¥–µ–ª–∏
- **–ò–°–ü–û–õ–¨–ó–£–ô –î–õ–Ø:** –±–∞–∑–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, middleware, –º–æ–¥–µ–ª–µ–π

### references/hackathon-app/
- FastAPI + aiogram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- Redis –æ–ø–µ—Ä–∞—Ü–∏–∏
- DAO –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è –ë–î
- **–ò–°–ü–û–õ–¨–ó–£–ô –î–õ–Ø:** webhook, Redis –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è, API

### references/aiogram-bot-template/
- Filters (is_admin, is_banned)
- Services layer
- Keyboards –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è
- **–ò–°–ü–û–õ–¨–ó–£–ô –î–õ–Ø:** —Ñ–∏–ª—å—Ç—Ä–æ–≤, —Å–µ—Ä–≤–∏—Å–æ–≤, —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã—Ö keyboards

## ‚úÖ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï –ü–†–ê–í–ò–õ–ê

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```python
# –í–°–ï–ì–î–ê –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π logger –≤ –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞
from loguru import logger

# –õ–æ–≥–∏—Ä—É–π –≤–∞–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
logger.info(f"üîò Callback: {callback.data} | User: {callback.from_user.id}")
logger.error(f"‚ùå Error: {e}")
```

### Callback handlers
```python
@router.callback_query(F.data == "some:action")
async def handler(callback: CallbackQuery, session: AsyncSession) -> None:
    logger.info(f"üîò Callback: {callback.data}")
    
    # ... –ª–æ–≥–∏–∫–∞ ...
    
    await callback.answer()  # –í–°–ï–ì–î–ê –≤ –∫–æ–Ω—Ü–µ!
```

### Middleware
```python
# Database middleware - —Å–º–æ—Ç—Ä–∏ references/aiogram-sqlalchemy/app/middlewares/
# Auth middleware - —Å–º–æ—Ç—Ä–∏ references/aiogram-bot-template/src/bot/middlewares/
```

## üö´ –ó–ê–ü–†–ï–¢–´

1. **–ù–ï —Å–º–µ—à–∏–≤–∞–π aiogram 2 –∏ aiogram 3 —Å–∏–Ω—Ç–∞–∫—Å–∏—Å**
   - aiogram 2: `@dp.callback_query_handler()`
   - aiogram 3: `@router.callback_query()`

2. **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–π print()** ‚Äî —Ç–æ–ª—å–∫–æ logger

3. **–ù–ï —É–¥–∞–ª—è–π healthcheck endpoint** ‚Äî Railway –µ–≥–æ —Ç—Ä–µ–±—É–µ—Ç

4. **–ù–ï –º–µ–Ω—è–π —Å–µ–∫—Ä–µ—Ç—ã:**
   - BOT_TOKEN
   - DATABASE_URL
   - PRODAMUS_SECRET_KEY
   - –†–µ–∫–≤–∏–∑–∏—Ç—ã –ò–ü (–ò–ù–ù, –û–ì–†–ù–ò–ü)

5. **–ù–ï —Ç—Ä–æ–≥–∞–π –ª–æ–≥–∏–∫—É –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–¥–ø–∏—Å–∏ Prodamus**

## üöÄ RAILWAY –°–ü–ï–¶–ò–§–ò–ö–ê

### Healthcheck (–û–ë–Ø–ó–ê–¢–ï–õ–ï–ù!)
```python
# Web server –¥–æ–ª–∂–µ–Ω —Å—Ç–∞—Ä—Ç–æ–≤–∞—Ç—å –î–û polling
# Endpoint /health –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—á–∞—Ç—å 200 OK
async def health_handler(request):
    return web.Response(text="OK", status=200)
```

### –û–¥–∏–Ω –∏–Ω—Å—Ç–∞–Ω—Å
- Replicas = 1 (–∏–Ω–∞—á–µ TelegramConflictError)
- –ù–µ –∑–∞–ø—É—Å–∫–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ –∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

## üí≥ –ü–õ–ê–¢–ï–ñ–ò (Prodamus)

- Webhook endpoint: `/prodamus-webhook`
- –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∏: HMAC-SHA256
- **–°–º–æ—Ç—Ä–∏:** `bot/handlers/prodamus_webhook.py`
- **–ù–ï –ú–ï–ù–Ø–¢–¨** –ª–æ–≥–∏–∫—É –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏!

## üìù –ü–û–õ–ï–ó–ù–´–ï –ü–ê–¢–¢–ï–†–ù–´

### Keyboard —Å –∫–Ω–æ–ø–∫–æ–π –Ω–∞–∑–∞–¥
```python
# –°–º–æ—Ç—Ä–∏ references/aiogram-sqlalchemy/app/keyboards/
def back_to_menu_keyboard() -> InlineKeyboardMarkup:
    buttons = [
        [InlineKeyboardButton(text="¬´ –ù–∞–∑–∞–¥", callback_data="menu:main")]
    ]
    return InlineKeyboardBuilder(markup=buttons).as_markup()
```

### Service layer
```python
# –°–º–æ—Ç—Ä–∏ references/aiogram-bot-template/src/infrastructure/services/
async def get_user(session: AsyncSession, user_id: int) -> User | None:
    result = await session.execute(
        select(UserModel).where(UserModel.telegram_id == user_id)
    )
    return result.scalar_one_or_none()
```

### Database model
```python
# –°–º–æ—Ç—Ä–∏ references/aiogram-sqlalchemy/database/models/
class UserModel(Base):
    __tablename__ = "users"
    
    id: Mapped[int] = mapped_column(primary_key=True)
    telegram_id: Mapped[int] = mapped_column(BigInteger, unique=True, index=True)
    username: Mapped[str | None] = mapped_column(String(255), nullable=True)
    created_at: Mapped[datetime] = mapped_column(default=datetime.utcnow)
```

## üîç –ö–ê–ö –ò–°–ö–ê–¢–¨ –û–ë–†–ê–ó–¶–´

–ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ —Ç–∏–ø–∞ "–∫–∞–∫ —Å–¥–µ–ª–∞—Ç—å X" ‚Äî —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—å:

1. `references/aiogram-sqlalchemy/` ‚Äî –±–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
2. `references/hackathon-app/` ‚Äî Redis, API, webhook
3. `references/aiogram-bot-template/` ‚Äî filters, services, keyboards

## ‚ö° –ë–´–°–¢–†–´–ï –ö–û–ú–ê–ù–î–´

```bash
# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
alembic upgrade head

# –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
alembic revision --autogenerate -m "description"

# –ó–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ
python -m bot
```
